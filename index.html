<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./css/all.css" rel="stylesheet" />
    <link href="./css/bulma.css" rel="stylesheet" />
    <script src="./js/all.js"></script>
    <script src="./js/vue.js"></script>
    <title>My ToDo List</title>
  </head>
  <body>
    <section class="hero">
      <div class="hero-body">
        <p class="title">My ToDo List</p>
        <!-- <p class="subtitle">Hero subtitle</p> -->
      </div>
    </section>
    <section id="app">
      <div class="container">
        <p class="subtitle my-2">Completed: {{completedCount}} Tasks</p>
        <p class="subtitle my-2">Incomplete: {{incompleteCount}} Tasks</p>
        <div class="columns">
          <div class="column is-8">
            <template v-for="task in tasks">
              <div
                class="box level py-3 my-2"
                v-show="!task.isComplete || (task.isComplete && !isHide)"
              >
                <div class="control">
                  <label class="checkbox">
                    <input type="checkbox" v-model="task.isComplete" />
                    <span
                      :style="{'text-decoration' : task.isComplete ? 'line-through' : ''}"
                      >{{task.name}}</span
                    >
                  </label>
                </div>
                <div class="level-right">
                  <span class="icon is-small" @click="editTask(task.id)">
                    <i class="fas fa-edit"></i>
                  </span>
                  <span class="icon is-small ml-5" @click="DeleteTask(task.id)">
                    <i class="fas fa-trash-alt"></i>
                  </span>
                </div>
              </div>
            </template>
            <div class="columns mt-5">
              <div class="column is-8">
                <div class="field">
                  <div class="control">
                    <input
                      class="input"
                      type="text"
                      placeholder="Task Name"
                      v-model="newTaskName"
                    />
                  </div>
                </div>
              </div>
              <div class="column is-4">
                <p class="control">
                  <a class="button is-info" @click="addTask()">
                    Add New Task
                  </a>
                </p>
              </div>
            </div>
          </div>
          <div class="column is-4">
            <div class="card">
              <header class="card-header has-background-primary">
                <p class="card-header-title">Sort & Filter</p>
                <p class="card-header-icon">
                  <span class="card-header-icon icon">
                    <i class="fas fa-filter"></i>
                  </span>
                </p>
              </header>
              <div class="card-content">
                <div class="content">
                  <div class="control">
                    <label class="checkbox">
                      <input type="checkbox" v-model="isHide" />
                      Hide completed tasks
                    </label>
                  </div>
                  <div class="control">
                    <label class="checkbox">
                      <input type="checkbox" v-model="isSort" />
                      Sort incomplete tasks first
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- EditTask -->
      <div class="modal" :class="{'is-active': EditModal }">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Edit title</p>
            <button
              class="delete"
              aria-label="close"
              @click="EditModal = false"
            ></button>
          </header>
          <section class="modal-card-body">
            <!-- Content ... -->
            <div class="field">
              <div class="control">
                <input
                  class="input"
                  type="text"
                  placeholder="Task Name"
                  v-model="editTaskName"
                />
              </div>
            </div>
          </section>
          <footer class="modal-card-foot">
            <button class="button is-success" @click="saveEdit">
              Save changes
            </button>
            <button class="button" @click="EditModal = false">Cancel</button>
          </footer>
        </div>
      </div>
      <!-- DeleteTask -->
      <div class="modal" :class="{'is-active': DelModal }">
        <div class="modal-background"></div>
        <div class="modal-card">
          <section class="modal-card-body">
            <!-- Content ... -->
            Are you sure you want to delete "{{delTaskName}}"?
          </section>
          <footer class="modal-card-foot">
            <button class="button is-danger" @click="confirmDelete">
              Confirm
            </button>
            <button class="button" @click="DelModal = false">Cancel</button>
          </footer>
        </div>
      </div>
    </section>
    <script>
      var app = new Vue({
        el: "#app",
        data: {
          tasks: [
            { id: 1, name: "task1", isComplete: false },
            { id: 2, name: "task2", isComplete: false },
            { id: 3, name: "task3", isComplete: false },
          ],
          newTaskName: "",
          idCouter: 3,
          EditModal: false,
          DelModal: false,
          editTaskName: "",
          editTaskId: 0,
          delTaskName: "",
          delTaskId: 0,
          isHide: false,
          isSort: false,
        },
        computed: {
          completedCount() {
            return this.tasks.filter((x) => x.isComplete == true).length;
          },
          incompleteCount() {
            return this.tasks.filter((x) => {
              return !x.isComplete;
            }).length;
          },
        },
        methods: {
          addTask() {
            this.idCouter++;
            this.tasks.push({
              id: this.idCouter,
              name: this.newTaskName,
              isComplete: false,
            });
            this.newTaskName = "";
            this.resort();
          },
          resort() {
            if (this.isSort) {
              this.sortTaskByStatus();
            } else {
              this.sortTaskByName();
            }
          },
          editTask(id) {
            this.EditModal = true;
            let selectedTask = this.tasks.filter((x) => x.id == id)[0];
            this.editTaskName = selectedTask.name;
            this.editTaskId = selectedTask.id;
          },
          saveEdit() {
            let selectedTask = this.tasks.filter((x) => {
              return x.id == this.editTaskId;
            })[0];
            selectedTask.name = this.editTaskName;
            this.EditModal = false;
            this.resort();
          },
          DeleteTask(id) {
            this.DelModal = true;
            let selectedTask = this.tasks.filter((x) => x.id == id)[0];
            this.delTaskName = selectedTask.name;
            this.delTaskId = selectedTask.id;
          },
          confirmDelete() {
            let selectedTask = this.tasks.filter((x) => {
              return x.id == this.delTaskId;
            })[0];
            this.tasks.splice(this.tasks.indexOf(selectedTask), 1);
            this.DelModal = false;
          },
          sortTaskByStatus() {
            function compare(a, b) {
              if (a.isComplete && !b.isComplete) {
                return 1;
              }
              if (!a.isComplete && b.isComplete) {
                return -1;
              }
              return 0;
            }
            this.tasks.sort(compare);
          },
          sortTaskByName() {
            function compare(a, b) {
              if (a.name < b.name) {
                return -1;
              }
              if (a.name > b.name) {
                return 1;
              }
              return 0;
            }
            this.tasks.sort(compare);
          },
        },
        watch: {
          isSort(newVal, oldVal) {
            if (newVal) {
              this.sortTaskByStatus();
            }
          },
        },
        created() {
          this.resort();
        },
      });
    </script>
  </body>
</html>
